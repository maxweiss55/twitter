---
title: "twitter"
author: "Max Weiss"
date: "10/31/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(dplyr)
library(tidyverse)
library(stringr)
library(lubridate)
library(knitr)
library(tidytext)
data("stop_words")

```


```{r scratch, message = FALSE, warning = FALSE}

trump <- read_csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/twitter-ratio/realDonaldTrump.csv")

obama <- read_csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/twitter-ratio/BarackObama.csv")

sens <- read_csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/twitter-ratio/senators.csv")

obama <- obama %>%
  mutate(bioguide_id = NA, party = NA, state = NA)

trump <- trump %>%
  mutate(bioguide_id = NA, party = NA, state = NA)

all_tweets <- rbind(trump, obama, sens)

write.csv(all_tweets, file = "all_tweets.csv") 

twitter <- read_csv("all_tweets.csv")

twitter_clean <- twitter %>%
  select(user, created_at, text, replies, retweets, favorites, party, state) %>%
  mutate(created_at = mdy_hm(created_at),
         party = case_when(party == "D" ~ "Democrat", 
                           party == "R" ~ "Republican",
                           party == "I" ~ "Independent",
                           user == "realDonaldTrump" ~ "Trump")) %>%
  filter(user != "BarackObama", created_at > "2017-01-20" & created_at < "2017-10-20") %>%
  rename("User" = "user", "Time" = "created_at", "Text" = "text", "Replies" = "replies", "Retweets" = "retweets", "Favorites" = "favorites", "Party" = "party", "State" = "state")

summary <- twitter_clean %>%
  group_by(Party) %>%
  summarize("Total Users" = n_distinct(User),
            "Total Tweets" = n(),
            "Average Replies" = round(mean(Replies)),
            "Average Retweets" = round(mean(Retweets)),
            "Average Favorites" = round(mean(Favorites))) %>%
  kable()


count <- twitter_clean %>%
  filter(Party == "Republican") %>%
  unnest_tokens(word, Text) %>%
  anti_join(stop_words) %>%
  count(word) %>%
  arrange(desc(n)) %>%
  filter(word != "https", word != "t.co", word != "amp", word != "rt") %>%
  head(n = 100)

wordcloud2(count_t)

average_use <- twitter_clean %>%
  group_by(Party) %>%
  unnest_tokens(word, Text) %>%
  count(word) %>%
  group_by(Party) %>%
  mutate(total_words = sum(n),
         avg_count = n / total_words) %>%
  filter(word == "news") %>%
  ggplot(aes(x = Party, y = avg_count)) +
  geom_col(fill = "skyblue", color = "navy blue")

average_use

random_select <- twitter_clean %>%
  select(-Party, -State) %>%
  sample_n(1)
  
random_summary <- random_select %>%
  select(-Text)

random_text <- random_select %>%
  select(Text)

      twitter_clean %>%
        select(-Party, -State) %>%
        sample_n(1) %>%
        select(-Replies, -Retweets, -Favorites)  



```

